<!-- create-account-modal -->
{% load static %}
<div class="modal fade" id="change-pass-modal" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">New Password</h3>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                    <form action="{% url 'change_password' %}" method="POST" id="change-password-form">
                        {% csrf_token %}
                        <div class="input-area mt-2 mb-0">
                            <div class="input-section">
                                <div class="pass-field">
                                    <input type="password" id="new-password-field" name="password" class="user-input" maxlength="16" placeholder="">
                                    <div id="new-password-label" class="input-label" style="color: rgb(14, 30, 75);">New Password</div>
                                    <i class="bi bi-eye" id="new-pass-eye"></i>
                                </div>
                                <div class="password-policy p-0 pt-2 ps-2">
                                    <span class="pp-header">Password must contain</span>
                                    <ul class="requirement-list p-0">
                                        <li>
                                            <i class="bi bi-circle"></i>
                                            <span>At least 1 number (0...9)</span>
                                        </li>
                                        <li>
                                            <i class="bi bi-circle"></i>
                                            <span>At least 8 characters length</span>
                                        </li>
                                        <li>
                                            <i class="bi bi-circle"></i>
                                            <span>At least 1 lowercase letter (a...z)</span>
                                        </li>
                                        <li>
                                            <i class="bi bi-circle"></i>
                                            <span>At least 1 uppercase letter (A...Z)</span>
                                        </li>
                                        <li>
                                            <i class="bi bi-circle"></i>
                                            <span>At least 1 special symbol</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="input-section">
                                <div class="pass-field">
                                    <input type="password" id="con-password-field" name="confirm_password" class="user-input" maxlength="16" placeholder="" required>
                                    <div id="con-password-label" class="input-label">Confirm Password</div>
                                    <i class="bi bi-eye" id="con-pass-eye"></i>
                                </div>
                                <span id="password-error" class="error-msg"></span>
                            </div>
                        </div>

                    <div class="modal-footer">
                        <div class="mf-button">
                            <button type="submit" id="change-button" class="btn btn-lg w-70 h-100 fs-6 btn-submit" data-bs-toggle="modal" data-bs-target="#forgot-success-modal" disabled>Change Password</button>
                        </div>
                    </div>
                </form>

            </div>

        </div>
    </div>
</div>


<script src="{% static 'js/password_policy.js' %}"></script>
<script src="{% static 'js/password_toggle.js' %}"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('change-password-form');
        const modal = new bootstrap.Modal(document.getElementById('change-pass-modal'));
    
        form.addEventListener('submit', function (event) {
            event.preventDefault();
            modal.hide();
    
            setTimeout(function () {
                form.submit(); 
            }, 300); 
        });
    });
    

$(document).ready(function() {
    // Initially disable the reset button
    $('.btn-submit').prop('disabled', true);

    // Function to check overall form validity and update button state
    function updateButtonState() {
        const password = $('#new-password-field').val();
        const confirmPassword = $('#con-password-field').val();
    
        // Check if both passwords match and the email is valid
        let passwordsMatch = password === confirmPassword;
        $('#change-button').prop('disabled', !passwordsMatch);
    }

    // Bind the validate function to the input event of email input field
    $(document).ready(function() {
        $('#new-password-field, #con-password-field').on('input', function() {
            updateButtonState(); // Call this function whenever any of the inputs change
        });
    });
    

    // Existing password validation functions (from your separate password_policy.js)
    document.getElementById("new-password-field").addEventListener("input", validatePassword);
    document.getElementById("con-password-field").addEventListener("input", validateConfirmPassword);
});

// Function to prevent spaces in input fields
function preventSpaces(event) {
    if (event.key === ' ') {
        event.preventDefault();
    }
}

// Attaching the event listener to input fields
document.addEventListener('DOMContentLoaded', function () {
    var inputs = document.querySelectorAll(' #new-password-field, #con-password-field');
    inputs.forEach(function(input) {
        input.addEventListener('keydown', preventSpaces);
    });
});
</script>