<!-- create-account-modal -->
<div class="modal fade" id="prev-account-modal" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Account</h3>
                <div class="edit-form">
                    <button class="btn btn-edit" id="edit-button">
                        <i class="bi bi-pencil-square"></i>
                        <span id="edit-text">Edit</span>
                    </button>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                aria-label="Close" id="closeButton"></button>
            </div>
            <div class="modal-body">

                <form action="{% url 'update_account'  %}" method="POST"  id="prev-account-form" novalidate>
                    <input type="hidden" id="account-id" name="account_id" value="">
                    {% csrf_token %}
                    <div class="form-row">
                        <div class="form-column">
                            <label for="prev-name" class="form-label">Name</label>
                            <input type="text" class="form-control" name="name" id="prev-name" placeholder="e.g. Juan Dela Cruz" 
                                   maxlength="60" required>
                            <span class="warning-text" id="name-warning" style="display:none; color:red;">Name is required</span>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-column">
                            <label for="prev-email" class="form-label">Email</label>
                            <input type="email" class="form-control" name="email" id="prev-email" placeholder="e.g. juandc@gmail.com" maxlength="100" required>
                            <span class="warning-text" id="email-warning" style="display:none; color:red;">Email is required</span>
                        </div>
                    </div>                

                    <div class="form-row">
                        <div class="form-column">
                            <label for="prev-role" class="form-label">Role</label>
                            <select class="form-select" aria-label="Default select example" name="role" id="prev-role">
                                <option value="Admin">Admin</option>
                                <option value="Radio Operator">Radio Operator</option>
                                <option value="Responder">Responder</option>
                            </select>                            
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-column">
                            <label for="prev-contact" class="form-label">Contact No.</label>
                            <input type="text" class="form-control" name="contact_number" id="prev-contact" placeholder="e.g. 09123456789" maxlength="11" required pattern="[0-9]{11}"
                            oninput="this.value=this.value.replace(/[^0-9]/g,'');">
                            <span class="warning-text" id="contact-warning" style="display:none; color:red;">Contact number is required</span>
                        </div>
                    </div>  

                    <div class="modal-footer">
                        <div class="mf-button">
                            <button class="btn btn-lg px-4 add-account" type="submit" disabled>Save</button>
                        </div>                   
                    </div>
                </form>

            </div>

        </div>
    </div>
</div>

<script>
    document.getElementById('prev-account-form').addEventListener('submit', function(event) {
        let isValid = true;
    
        // Reset all previous warnings
        document.querySelectorAll('.warning-text').forEach(function(warning) {
            warning.style.display = 'none';
        });
    
        // Check if the name field is empty
        const name = document.getElementById('prev-name');
        if (!name.value.trim()) {
            const nameWarning = document.getElementById('name-warning');
            nameWarning.style.display = 'inline'; // Show the warning text
            nameWarning.style.fontSize = '0.8rem';  // Optional: Set font size for the warning
            nameWarning.style.color = 'red'; // Optional: Set warning color
            isValid = false;
        }
    
        // Check if the email field is empty
        const email = document.getElementById('prev-email');
        if (!email.value.trim()) {
            const emailWarning = document.getElementById('email-warning');
            emailWarning.style.display = 'inline'; // Show the warning text
            emailWarning.style.fontSize = '0.8rem';  // Optional: Set font size for the warning
            emailWarning.style.color = 'red'; // Optional: Set warning color
            isValid = false;
        }
    
        // Check if the contact field is empty
        const contact = document.getElementById('prev-contact');
        if (!contact.value.trim()) {
            const contactWarning = document.getElementById('contact-warning');
            contactWarning.style.display = 'inline'; // Show the warning text
            contactWarning.style.fontSize = '0.8rem';  // Optional: Set font size for the warning
            contactWarning.style.color = 'red'; // Optional: Set warning color
            isValid = false;
        }
    
        // If any field is invalid, prevent form submission
        if (!isValid) {
            event.preventDefault();
            return; // Stop further execution to avoid the email/phone check
        }
    });
    </script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const nameField = document.getElementById('prev-name');
            const emailField = document.getElementById('prev-email');
            const contactField = document.getElementById('prev-contact');
            const form = document.getElementById('prev-account-form');
        
            // Store the initial values of email and contact number
            const initialEmail = emailField.value.trim();
            const initialContact = contactField.value.trim();
        
            // Function to show error messages
            function showError(field, message) {
                const warningText = field.parentNode.querySelector('.warning-text');
                if (warningText) {
                    warningText.innerText = message;
                    warningText.style.display = 'inline';  // Show the error message
                    warningText.style.fontSize = '0.8rem';  // Set font size for the warning
                    warningText.style.color = 'red'; // Set warning color
                }
                field.style.border = '1px solid red';  // Red border for the input field
            }
        
            // Function to clear error messages and reset input styles
            function clearErrorMessages() {
                document.querySelectorAll('.warning-text').forEach(function(warning) {
                    warning.style.display = 'none';  // Hide all warning messages
                });
                document.querySelectorAll('input').forEach(function(field) {
                    field.style.border = '';  // Reset input border to default
                });
            }
        
            // Event listener for form submission
            form.addEventListener('submit', function (event) {
                let isValid = true;
        
                // Clear previous error messages and reset styles
                clearErrorMessages();
        
                // Check if the name field is empty
                const name = nameField.value.trim();
                if (!name) {
                    showError(nameField, 'Name is required.');
                    isValid = false;
                }
        
                // Check if the email field is empty (if it's changed)
                const email = emailField.value.trim();
                if (!email) {
                    showError(emailField, 'Email is required.');
                    isValid = false;
                } else if (email !== initialEmail) {
                    // If email has changed, check for uniqueness
                    fetch(`/check-email/?email=${encodeURIComponent(email)}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.email_exists) {
                                showError(emailField, 'This email is already registered.');
                                isValid = false;
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            showError(emailField, 'Error. Already registered');
                            isValid = false;
                        });
                }
        
                if (!isValid) {
                    event.preventDefault();
                }
            });
        });
        </script>
        
        
        
        
        

<script>
    document.getElementById('closeButton').addEventListener('click', function() {
        location.reload(); // This will refresh the page
    });
</script>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const editButton = document.getElementById('edit-button');
        const form = document.getElementById('prev-account-form');
        const formFields = form.querySelectorAll('input, select, button');
        const icon = editButton.querySelector('i'); // Get the icon element
        const editText = document.getElementById('edit-text'); // Get the edit text

        // Initially disable all fields
        formFields.forEach(field => {
            if (field.type !== 'submit') {
                field.disabled = true;
            }
        });

        // Toggle editing mode on "Edit" button click
        editButton.addEventListener('click', function (event) {
            event.preventDefault(); // Prevent default behavior of button
            const isEditable = formFields[0].disabled; // Check if fields are currently disabled
            
            formFields.forEach(field => {
                if (field.type !== 'submit') {
                    field.disabled = !isEditable; // Toggle the disabled attribute
                }
            });

            // Change button text and handle icon visibility
            if (isEditable) {
                editText.textContent = 'Editing'; // Change text to 'Editing'
                icon.style.display = 'none'; // Hide the icon
                editButton.disabled = true; // Disable the edit button while editing
            } else {
                editText.textContent = 'Edit'; // Change text back to 'Edit'
                icon.style.display = 'inline'; // Show the icon again
                editButton.disabled = false; // Re-enable the edit button after editing
            }

            // Enable/disable the submit button
            const submitButton = form.querySelector('.add-account');
            submitButton.disabled = !isEditable;
        });
    });
</script>


